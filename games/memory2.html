<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シモン・メモリー</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta name="google-adsense-account" content="ca-pub-3571574988222927">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3571574988222927"
     crossorigin="anonymous"></script>
    <style>
        body { font-family: sans-serif; background-color: #2c3e50; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        h1 { margin-bottom: 10px; color: #ecf0f1; }
        #level { font-size: 1.5rem; margin-bottom: 20px; }
        .game-board { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 300px; height: 300px; }
        .panel { border-radius: 15px; cursor: pointer; transition: 0.1s; opacity: 0.4; border: 4px solid rgba(0,0,0,0.2); }
        .panel:active { transform: scale(0.95); }
        .active { opacity: 1 !important; transform: scale(1.05); box-shadow: 0 0 20px white; }
        #red { background-color: #ff4757; }
        #blue { background-color: #1e90ff; }
        #green { background-color: #2ed573; }
        #yellow { background-color: #ffa502; }
        .controls { margin-top: 30px; text-align: center; }
        .btn { padding: 12px 30px; font-size: 1.2rem; background: #ecf0f1; color: #2c3e50; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }
        .back-link { margin-top: 20px; display: block; color: #bdc3c7; text-decoration: none; }
    </style>
</head>
<body>

    <h1><i class="fa-solid fa-lightbulb"></i> シモン・メモリー</h1>
    <div id="level">レベル: 1</div>

    <div class="game-board">
        <div id="green" class="panel"></div>
        <div id="red" class="panel"></div>
        <div id="yellow" class="panel"></div>
        <div id="blue" class="panel"></div>
    </div>

    <div class="controls">
        <button id="startBtn" class="btn">スタート</button>
        <a href="/" class="back-link"><i class="fa-solid fa-arrow-left"></i> ゲーム一覧に戻る</a>
    </div>

<script>
    const panels = {
        green: document.getElementById('green'),
        red: document.getElementById('red'),
        yellow: document.getElementById('yellow'),
        blue: document.getElementById('blue')
    };
    const startBtn = document.getElementById('startBtn');
    const levelDisplay = document.getElementById('level');

    let sequence = [];
    let userSequence = [];
    let level = 1;
    let isWaiting = false;

    // 音の代わりのビープ設定
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
        osc.stop(audioCtx.currentTime + 0.5);
    }

    const sounds = { green: 261.6, red: 329.6, yellow: 392.0, blue: 523.3 };

    async function flash(color) {
        panels[color].classList.add('active');
        playSound(sounds[color]);
        await new Promise(r => setTimeout(r, 400));
        panels[color].classList.remove('active');
        await new Promise(r => setTimeout(r, 100));
    }

    async function playSequence() {
        isWaiting = false;
        userSequence = [];
        levelDisplay.textContent = `レベル: ${level}`;
        for (const color of sequence) {
            await flash(color);
        }
        isWaiting = true;
    }

    function nextLevel() {
        const colors = ['green', 'red', 'yellow', 'blue'];
        sequence.push(colors[Math.floor(Math.random() * 4)]);
        playSequence();
    }

    Object.keys(panels).forEach(color => {
        panels[color].addEventListener('click', async () => {
            if (!isWaiting) return;
            
            await flash(color);
            userSequence.push(color);

            const index = userSequence.length - 1;
            if (userSequence[index] !== sequence[index]) {
                alert(`ゲームオーバー！到達レベル: ${level}`);
                resetGame();
                return;
            }

            if (userSequence.length === sequence.length) {
                level++;
                isWaiting = false;
                setTimeout(nextLevel, 1000);
            }
        });
    });

    function resetGame() {
        sequence = [];
        level = 1;
        levelDisplay.textContent = "レベル: 1";
        startBtn.style.display = "inline-block";
        isWaiting = false;
    }

    startBtn.addEventListener('click', () => {
        startBtn.style.display = "none";
        resetGame();
        nextLevel();
    });
</script>
</body>
</html>
