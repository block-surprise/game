<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>„Éï„É´„Éº„ÉÑ„Éª„Éâ„É≠„ÉÉ„Éó</title>
    <meta name="google-adsense-account" content="ca-pub-3571574988222927">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3571574988222927" crossorigin="anonymous"></script>
    <link rel="icon" href="https://games.ad-hub.f5.si/image/favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="https://games.ad-hub.f5.si/image/apple-touch-icon.png">
    <meta name="theme-color" content="#007bff">
    <style>
        body { margin: 0; background: #fffae6; font-family: sans-serif; overflow: hidden; touch-action: none; display: flex; flex-direction: column; align-items: center; }
        #game-container { position: relative; width: 100vw; max-width: 400px; height: 80vh; background: #fff; border: 4px solid #edcf72; border-top: none; box-sizing: border-box; }
        canvas { display: block; }
        #score-ui { font-size: 1.5rem; font-weight: bold; color: #edcf72; margin: 10px 0; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 100; }
        .btn { background: #edcf72; color: white; border: none; padding: 10px 30px; border-radius: 20px; font-size: 1.2rem; cursor: pointer; margin-top: 10px; text-decoration: none; }
    </style>
</head>
<body>

    <div id="score-ui">SCORE: <span id="score">0</span></div>
    <div id="game-container">
        <canvas id="canvas"></canvas>
    </div>

    <div id="overlay">
        <h1>GAME OVER</h1>
        <p>„Çπ„Ç≥„Ç¢: <span id="final-score">0</span></p>
        <button class="btn" onclick="location.reload()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
        <a href="../index.html" class="btn" style="background: #888;">‰∏ÄË¶ß„Å´Êàª„Çã</a>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script>
    const { Engine, Render, Runner, Bodies, Composite, Events, Body } = Matter;

    const container = document.getElementById('game-container');
    const width = container.clientWidth - 8;
    const height = container.clientHeight - 4;
    let score = 0;
    let isGameOver = false;

    const engine = Engine.create();
    const canvas = document.getElementById('canvas');
    const render = Render.create({
        canvas: canvas,
        engine: engine,
        options: { width: width, height: height, wireframes: false, background: 'transparent' }
    });

    const ground = Bodies.rectangle(width/2, height + 25, width, 50, { isStatic: true, render: { fillStyle: '#edcf72' } });
    const wallL = Bodies.rectangle(-25, height/2, 50, height, { isStatic: true });
    const wallR = Bodies.rectangle(width + 25, height/2, 50, height, { isStatic: true });
    Composite.add(engine.world, [ground, wallL, wallR]);

    Render.run(render);
    Runner.run(Runner.create(), engine);

    const FRUITS = [
        { radius: 15, color: '#ff6b6b', label: 'üçì', score: 2 },
        { radius: 25, color: '#feca57', label: 'üçä', score: 4 },
        { radius: 35, color: '#ff9f43', label: 'üçé', score: 8 },
        { radius: 45, color: '#ff9ff3', label: 'üçë', score: 16 },
        { radius: 60, color: '#54a0ff', label: 'üçç', score: 32 },
        { radius: 80, color: '#1dd1a1', label: 'üçà', score: 64 },
        { radius: 100, color: '#ee5253', label: 'üçâ', score: 128 },
    ];

    function createFruit(x, y, level) {
        const config = FRUITS[level];
        const fruit = Bodies.circle(x, y, config.radius, {
            label: 'fruit_' + level,
            restitution: 0.5,
            render: { fillStyle: config.color }
        });
        fruit.fruitLevel = level;
        return fruit;
    }

    let nextLevel = 0;
    container.addEventListener('click', (e) => {
        if (isGameOver) return;
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const fruit = createFruit(x, 50, nextLevel);
        Composite.add(engine.world, fruit);
        nextLevel = Math.floor(Math.random() * 3); // ÊúÄÂàù„ÅØÂ∞è„Åï„ÅÑ„ÅÆ„Å†„Åë
    });

    Events.on(engine, 'collisionStart', (event) => {
        event.pairs.forEach(pair => {
            const { bodyA, bodyB } = pair;
            if (bodyA.label.startsWith('fruit_') && bodyA.label === bodyB.label) {
                const level = bodyA.fruitLevel;
                if (level < FRUITS.length - 1) {
                    const newX = (bodyA.position.x + bodyB.position.x) / 2;
                    const newY = (bodyA.position.y + bodyB.position.y) / 2;
                    Composite.remove(engine.world, [bodyA, bodyB]);
                    const newFruit = createFruit(newX, newY, level + 1);
                    Composite.add(engine.world, newFruit);
                    score += FRUITS[level].score;
                    document.getElementById('score').innerText = score;
                }
            }
        });
    });

    // Á∞°Êòì„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÂà§ÂÆöÔºà‰∏ä„Å´Ê∫ú„Åæ„Å£„Åü„ÇâÔºâ
    Events.on(engine, 'afterUpdate', () => {
        Composite.allBodies(engine.world).forEach(body => {
            if (!body.isStatic && body.position.y < 20 && body.velocity.y < 0.1) {
                isGameOver = true;
                document.getElementById('final-score').innerText = score;
                document.getElementById('overlay').style.display = 'flex';
            }
        });
    });
</script>
</body>
</html>
